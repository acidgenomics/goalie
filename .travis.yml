language: general

services:
  - docker

branches:
  only:
    - master

before_script:
  - chmod +x *.sh

jobs:
  include:
    - stage: test
      name: "linux bioc-3.9"
      script: image="basejump" tag="bioc-3.9" ./docker.sh
    - stage: test
      name: "linux bioc-3.8"
      script: image="basejump" tag="bioc-3.8" ./docker.sh
    - stage: test
      name: "linux bioc-3.7"
      script: image="basejump" tag="bioc-3.7" ./docker.sh
    - stage: test
      name: "linux bioc-devel"
      script: image="basejump" tag="bioc-devel" ./docker.sh
    - stage: test
      name: "macos bioc-release"
      os: osx
      language: r
      r: bioc-release

matrix:
  allow_failures:
    - name: "linux bioc-devel"
    - name: "macos bioc-release"
  fast_finish: true

after_failure:
  - ./docker-failure.sh

notifications:
  email:
    recipients:
      - mike@steinbaugh.com
    on_success: change
    on_failure: change
